language: php
php:
  - 7.3
  - 7.4
  - nightly

matrix:
  allow_failures:
    - php: nightly

env:
  - USE_OPCACHE=1 USE_ZEND_ALLOC=0
  - USE_OPCACHE=1 USE_ZEND_ALLOC=1
  - USE_OPCACHE=0 USE_ZEND_ALLOC=0
  - USE_OPCACHE=0 USE_ZEND_ALLOC=1

before_script:
  - echo "opcache.enable=$USE_OPCACHE" >> travis-opcache.ini
  - echo "opcache.enable_cli=$USE_OPCACHE" >> travis-opcache.ini
  - phpenv config-add travis-opcache.ini

script:
  - phpize
  - ./configure
  - make
  - REPORT_EXIT_STATUS=1 TEST_PHP_ARGS="-q --show-diff" make test

#notifications:
#  webhooks:
#    urls:
#      - https://webhooks.gitter.im/e/428fac7bd9f4b867c347
#    on_success: always
#    on_failure: always
#    on_start: always
